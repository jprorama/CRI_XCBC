---
- name: Copy the configure file for apps
  template:
    src: "{{ item }}/env_local.j2"
    dest: "{{ ood_sys_apps_dir }}/{{ item }}/.env.local"
  loop:
    - dashboard
    - myjobs
    - shell

- name: Add initializers folder
  file:
    path: /etc/ood/config/apps/dashboard/initializers
    state: directory

- name: Add shared directories into files menu
  template:
    src: dashboard/ood_rb.j2
    dest: /etc/ood/config/apps/dashboard/initializers/ood.rb

- name: Add cheaha favicon image
  copy:
    src: favicon.ico
    dest: "/var/www/ood/public"

- name: Add cheaha logo image
  copy:
    src: "{{ ood_dashboard_logo_filename }}"
    dest: "/var/www/ood/public"

- name: Restart apps to pickup new settings
  shell: |
    touch {{ ood_sys_apps_dir }}/{{ item }}/tmp/restart.txt
  loop:
    - dashboard
    - myjobs

- name: Clone rc message in place
  git:
    repo: "{{ rc_msg_repo }}"
    dest: "{{ ood_announcement_path }}"

- name: Create cronjob to pull latest message from git
  ansible.builtin.cron:
    minute: */15
    job: "/usr/bin/git --git-dir={{ ood_announcement_path }}/.git --work-tree={{ ood_announcement_path }} pull"
